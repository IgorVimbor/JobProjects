<!-- –®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "–î–µ—Ñ–µ–∫—Ç—ã –ø–æ –≤–∏–Ω–æ–≤–Ω–∏–∫–∞–º" -->

<!-- reports/templates/reports/culprits_defect.html -->

{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'reports:references' %}">–û—Ç—á–µ—Ç—ã</a></li>
                    <li class="breadcrumb-item active">{{ page_title }}</li>
                </ol>
            </nav>

            <h3 class="text-muted">{{ description }}</h3>
        </div>
    </div>

    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç—á–µ—Ç–∞ -->
    {% if not report_data %}
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞</h5>
                </div>
                <div class="card-body">
                    <p><strong>–û—Ç—á–µ—Ç–Ω—ã–π –º–µ—Å—è—Ü:</strong> {{ report_month }} {{ report_year }} –≥–æ–¥–∞</p>

                    <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è -->
                    <hr class="my-3">

                    <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä –∞–∫—Ç–∞ –∏–∑ JSON —Ñ–∞–π–ª–∞ -->
                    {% comment %} <p>
                        <strong>–ù–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–∫—Ç–∞</strong>, –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –≤ —Å–ø—Ä–∞–≤–∫—É:
                        {% if max_act_number %}
                            <span><strong>{{ max_act_number }}</strong></span>
                        {% else %}
                            <span>–Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</span>
                        {% endif %}
                    </p> {% endcomment %}

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                    <div class="alert alert-info mb-4">
                        –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–ø—Ä–∞–≤–∫–∞ —Å–æ—Å—Ç–∞–≤–ª—è–ª–∞—Å—å –∑–∞ <strong>{{ month_name }}</strong> {{ report_year }} –≥–æ–¥–∞ –ø–æ –∞–∫—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
                        —Å <strong>{{ start_act_number }}</strong> –ø–æ <strong>{{ max_act_number }}</strong>
                    </div>

                    <form method="post">
                        {% csrf_token %}

                        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ –∞–∫—Ç–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è -->
                        <div class="mb-3">
                            <input type="number"
                                   class="form-control"
                                   id="act_number"
                                   name="act_number"
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 547"
                                   value="{{ max_act_number|default:'' }}"
                                   min="0"
                                   required>
                            <small class="form-text text-muted">
                                ‚úÖ –ù–æ–º–µ—Ä –∞–∫—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
                                <br>
                                –ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ–¥—ë–Ω –Ω–∞—á–∏–Ω–∞—è —Å–æ <strong>—Å–ª–µ–¥—É—é—â–µ–≥–æ</strong> –Ω–æ–º–µ—Ä–∞ –∞–∫—Ç–∞.
                            </small>
                        </div>

                        <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è -->
                        <hr class="my-3">

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                        <br>
                        <div class="card border-secondary mb-4">
                            <div class="card-header">
                                <h5>‚ÑπÔ∏è –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è</h5>
                            </div>
                            <div class="card-body">
                                <ul class="mb-0">
                                    <li>–¢–æ–ª—å–∫–æ —Ä–µ–∫–ª–∞–º–∞—Ü–∏–∏ <strong>–ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–µ</strong> –ø–æ –∞–∫—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.</li>
                                    <li>–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–∏–Ω–æ–≤–Ω–∏–∫–∞–º: <strong>–ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∑–∞–≤–æ–¥–∞</strong> –∏ <strong>–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ (–ë–ó–ê)</strong>.</li>
                                    <li>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º –∏ –∏–∑–¥–µ–ª–∏—è–º.</li>
                                </ul>
                            </div>
                        </div>

                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                        <div class="alert alert-info mb-4">
                            <strong>–î–∞—Ç–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏:</strong> {{ current_date }}
                        </div>

                        <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è -->
                        <hr class="my-3">

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="d-flex gap-2 justify-content-end">
                            <button type="submit" class="btn btn-primary">
                                üìä –°–¥–µ–ª–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="resetToDefault()">
                                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –∏–∑ –±–∞–∑—ã
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearForm()">
                                ‚ùå –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    {% if messages %}
    <div class="row">
        <div class="col-12">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ë–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    {% if report_data %}

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–µ–¥—É—é—â–µ–º –∞–Ω–∞–ª–∏–∑–µ -->
    {% if report_data.max_act_number %}
    <div class="row mt-3">
        <div class="col-12">
            <div class="alert alert-success">
                ‚úÖ –°–ø—Ä–∞–≤–∫–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –ø–æ –∞–∫—Ç–∞–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å <strong>{{ report_data.start_act_number }}</strong> –ø–æ <strong>{{ report_data.max_act_number }}</strong>
                <br>
                <small class="text-muted">–ù–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∞–∫—Ç–∞, –≤–∫–ª—é—á—ë–Ω–Ω–æ–≥–æ –≤ –¥–∞–Ω–Ω—É—é —Å–ø—Ä–∞–≤–∫—É, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.</small>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –¢–ê–ë–õ–ò–¶–ê 1: –î–µ—Ñ–µ–∫—Ç—ã –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º (–≤–∏–Ω–æ–≤–Ω–∏–∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω) -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-success">
                <div class="card-header text-dark">
                    <h5>1. –î–µ—Ñ–µ–∫—Ç—ã –ø–æ –≤–∏–Ω–æ–≤–Ω–∏–∫–∞–º</h5>
                    <small>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π: {{ report_data.not_bza_count }}</small>
                </div>
                <div class="card-body">
                    {% if report_data.not_bza_data %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm">
                            <thead class="table-info">
                                <tr>
                                    <th>–í–∏–Ω–æ–≤–Ω–∏–∫</th>
                                    <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å</th>
                                    <th>–ò–∑–¥–µ–ª–∏–µ</th>
                                    <th>–ó–∞–≤–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä</th>
                                    <th>–î–∞—Ç–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</th>
                                    <th>–ö–æ–ª-–≤–æ</th>
                                    <th>–ù–æ–º–µ—Ä–∞ –∞–∫—Ç–æ–≤</th>
                                    <th>–ü—Ä–∏—á–∏–Ω—ã –¥–µ—Ñ–µ–∫—Ç–æ–≤</th>
                                    <th>–ü–æ—è—Å–Ω–µ–Ω–∏—è</th>
                                </tr>
                            </thead>
                            <tbody style="font-size: 0.85rem;">
                                {% for row in report_data.not_bza_data %}
                                <tr>
                                    <td><strong>{{ row.–í–∏–Ω–æ–≤–Ω–∏–∫ }}</strong></td>
                                    <td>{{ row.–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å }}</td>
                                    <td>{{ row.–ò–∑–¥–µ–ª–∏–µ }}</td>
                                    <td>{{ row.–ó–∞–≤–æ–¥—Å–∫–æ–π_–Ω–æ–º–µ—Ä }}</td>
                                    <td>{{ row.–î–∞—Ç–∞_–∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è }}</td>
                                    <td><strong>{{ row.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ }}</strong></td>
                                    <td>{{ row.–ù–æ–º–µ—Ä–∞_–∞–∫—Ç–æ–≤ }}</td>
                                    <td>{{ row.–ü—Ä–∏—á–∏–Ω—ã }}</td>
                                    <td>{{ row.–ü–æ—è—Å–Ω–µ–Ω–∏—è }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–ê 2: –î–µ—Ñ–µ–∫—Ç—ã –ë–ó–ê (–≤–∏–Ω–æ–≤–Ω–∏–∫ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω)-->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header text-dark">
                    <h5>2. –î–µ—Ñ–µ–∫—Ç—ã –±–µ–∑ —Ü–µ–Ω—Ç—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ - –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ (–ë–ó–ê)</h5>
                    <small>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π: {{ report_data.bza_count }}</small>
                </div>
                <div class="card-body">
                    {% if report_data.bza_data %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-sm">
                            <thead class="table-warning">
                                <tr>
                                    <th>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å</th>
                                    <th>–ò–∑–¥–µ–ª–∏–µ</th>
                                    <th>–ó–∞–≤–æ–¥—Å–∫–æ–π –Ω–æ–º–µ—Ä</th>
                                    <th>–î–∞—Ç–∞ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</th>
                                    <th>–ö–æ–ª-–≤–æ</th>
                                    <th>–ù–æ–º–µ—Ä–∞ –∞–∫—Ç–æ–≤</th>
                                    <th>–ü—Ä–∏—á–∏–Ω—ã –¥–µ—Ñ–µ–∫—Ç–æ–≤</th>
                                    <th>–ü–æ—è—Å–Ω–µ–Ω–∏—è</th>
                                </tr>
                            </thead>
                            <tbody style="font-size: 0.85rem;">
                                {% for row in report_data.bza_data %}
                                <tr>
                                    <td>{{ row.–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å }}</td>
                                    <td>{{ row.–ò–∑–¥–µ–ª–∏–µ }}</td>
                                    <td>{{ row.–ó–∞–≤–æ–¥—Å–∫–æ–π_–Ω–æ–º–µ—Ä }}</td>
                                    <td>{{ row.–î–∞—Ç–∞_–∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è }}</td>
                                    <td><strong>{{ row.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ }}</strong></td>
                                    <td>{{ row.–ù–æ–º–µ—Ä–∞_–∞–∫—Ç–æ–≤ }}</td>
                                    <td>{{ row.–ü—Ä–∏—á–∏–Ω—ã }}</td>
                                    <td>{{ row.–ü–æ—è—Å–Ω–µ–Ω–∏—è }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –¥–µ—Ñ–µ–∫—Ç–∞–º –±–µ–∑ —Ü–µ–Ω—Ç—Ä–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="row mt-3 mb-4">
        <div class="col-12">
            <div class="d-flex gap-2 justify-content-end">
                <a href="{% url 'reports:culprits_defect' %}?clear=1" class="btn btn-primary">
                    üîÑ –ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
                </a>
                <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª -->
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-primary" name="action" value="save_files">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
                    </button>
                </form>
                <button class="btn btn-outline-primary" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                    ‚¨ÜÔ∏è –í–≤–µ—Ä—Ö
                </button>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
function clearForm() {
    document.getElementById('act_number').value = '';
}

// –°–±—Ä–æ—Å –∫ –∑–Ω–∞—á–µ–Ω–∏—é –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
function resetToDefault() {
    const defaultValue = '{{ max_act_number|default:"" }}';
    document.getElementById('act_number').value = defaultValue;
}
</script>

{% endblock %}