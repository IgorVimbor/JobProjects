<!-- Шаблон формы группового добавления накладной прихода рекламационных изделий -->

<!-- templates\admin\add_group_invoice_into.html
 Наследуемся от кастомного базового шаблона admin/group_form_base.html, сохраняя всю базовую структуру и стили.
 При необходимости можно добавлять свои стили или переопределять блоки
-->

{% extends "admin/group_form_base.html" %}
{% load i18n admin_urls %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
    &rsaquo; <a href="{% url 'admin:reclamations_reclamation_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
    &rsaquo; {{ title }}
</div>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
{# Если нужны дополнительные стили специфичные для формы накладных #}
{% endblock %}


{% block content %}

<!-- Блок предварительного просмотра -->
{% if preview_mode and preview_messages %}
<ul class="messagelist">
    <li class="info"><strong>Результаты предварительного просмотра:</strong></li>
    {% for msg in preview_messages %}
        <li class="{% if msg.level == 'info' %}info{% elif msg.level == 'success' %}success{% elif msg.level == 'warning' %}warning{% else %}error{% endif %}">
            {{ msg.message }}
        </li>
    {% endfor %}
    {% if found_records %}
        <li class="info">
            <strong>Для применения изменений нажмите кнопку "Применить"</strong>
        </li>
    {% endif %}
</ul>
{% endif %}

{{ block.super }}

<!-- JavaScript для добавления кнопки -->
<script>
document.addEventListener('DOMContentLoaded', function() {

    // Находим форму
    const form = document.querySelector('form[method="post"]');
    if (!form) {
        // если форма не найдена завершаем работу
        return;
    }

    // Находим контейнер с кнопками
    let submitRow = form.querySelector('.submit-row');
    if (!submitRow) {
        // Если нет .submit-row, ищем любые кнопки submit
        const submitBtn = form.querySelector('input[type="submit"]');
        if (submitBtn) {
            submitRow = submitBtn.parentNode;
        }
    }

    if (!submitRow) {
        // если контейнер кнопок не найден завершаем работу
        return;
    }

    // Создаем кнопку предварительного просмотра
    const previewBtn = document.createElement('input');
    previewBtn.type = 'submit';
    previewBtn.name = 'action';
    previewBtn.value = 'Предварительный просмотр';
    previewBtn.className = 'default';
    previewBtn.style.marginRight = '10px';

    // Добавляем кнопку в начало контейнера
    submitRow.insertBefore(previewBtn, submitRow.firstChild);

});
</script>

<!-- Добавляем ссылку "Вернуться к рекламациям" внизу формы -->
<a href="{% url 'admin:investigations_investigation_changelist' %}" class="btn btn-secondary">
    ← Вернуться к исследованиям
</a>
<br><br>
<a href="{% url 'admin:reclamations_reclamation_changelist' %}" class="btn btn-secondary">
    ← Вернуться к рекламациям
</a>
{% endblock %}